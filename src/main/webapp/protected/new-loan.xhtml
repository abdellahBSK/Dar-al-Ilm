<ui:composition xmlns="http://www.w3.org/1999/xhtml"
                xmlns:h="jakarta.faces.html"
                xmlns:f="jakarta.faces.core"
                xmlns:ui="jakarta.faces.facelets"
                template="/WEB-INF/templates/layout.xhtml">

    <ui:define name="content">
        <div style="max-width: 600px; margin: 0 auto; background: white; padding: 2rem; border-radius: var(--radius); box-shadow: var(--shadow);">
            <h2>Process New Loan</h2>
            <!-- Check if prepareCreate method is available or just rely on bean init -->
            <f:metadata>
                <f:viewAction action="#{loanBean.prepareCreate}" />
            </f:metadata>
            
            <h:form>
                <h:messages globalOnly="true" style="color: red; list-style: none; margin-bottom: 1rem;" />
                
                <div style="margin-bottom: 1rem;">
                    <h:outputLabel value="Select Member" style="display: block; margin-bottom: 0.5rem;"/>
                    <h:selectOneMenu value="#{loanBean.selectedMemberId}" required="true" requiredMessage="Member is required" style="width: 100%; padding: 0.5rem; box-sizing: border-box;">
                        <f:selectItem itemLabel="Select Member..." itemValue="" />
                        <f:selectItems value="#{loanBean.availableMembers}" var="m" itemLabel="#{m.fullName} (#{m.email})" itemValue="#{m.id}" />
                    </h:selectOneMenu>
                </div>
                
                <div style="margin-bottom: 1rem;">
                    <h:outputLabel value="Select Book" style="display: block; margin-bottom: 0.5rem;"/>
                    <h:selectOneMenu value="#{loanBean.selectedBookId}" required="true" requiredMessage="Book is required" style="width: 100%; padding: 0.5rem; box-sizing: border-box;">
                         <f:selectItem itemLabel="Select Book..." itemValue="" />
                         <f:selectItems value="#{loanBean.availableBooks}" var="b" itemLabel="#{b.title} (Available: #{b.quantity})" itemValue="#{b.id}" />
                    </h:selectOneMenu>
                </div>

                <div style="margin-top: 1.5rem; display: flex; gap: 1rem;">
                    <h:commandButton value="Confirm Loan" action="#{loanBean.createLoan}" styleClass="btn btn-primary" />
                    <h:button value="Cancel" outcome="loans" styleClass="btn" style="background: #9e9e9e; color: white;" />
                </div>
            </h:form>
        </div>
    </ui:define>

</ui:composition>
